<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <meta name="referrer" content="no-referrer">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HTTP-FLV Live</title>
  <style>
    body { margin:0; background:#000; display:grid; place-items:center; height:100vh;}
    video { width: min(100vw, 960px); height: auto; background:#000; }
  </style>
</head>
<body>
  <video id="video" controls playsinline muted></video>

  <!-- flv.js CDN（也可自行托管） -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/flv.js/1.3.2/flv.js" integrity="sha512-UTxsDdgec7gjU9NI28wYec0pgPtPCjSwOjaa5vwmK4wN9PKg2wsJ6Hw6Z4WGk4nJev6Spd3J+szIhhMNAdUwGA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    const url = 'http://54.199.44.46:8080/live/edge_IPC-ff808181983b7e3101983b92fb580006_1947967265123844097.flv'; // ← 替换为 YOUR_HTTP_FLV_URL
    const video = document.getElementById('video');
	
	console.log(window.MediaSource); 

    if (window.flvjs && flvjs.isSupported()) {
      const flvPlayer = flvjs.createPlayer({
        type: 'flv',
        isLive: true,
        url,
        // 可选：明确标注是否含音视频，能略微减少探测开销
        hasAudio: false,
        hasVideo: true,
      }, {
        enableWorker: true,              // 后台线程解析
        enableStashBuffer: false,        // 低延迟建议关闭缓冲池
        autoCleanupSourceBuffer: true,
        // 低延迟相关（按需调）
        liveBufferLatencyChasing: true,  // 追帧
        // stashInitialSize: 128,        // 默认 KB，打开 enableStashBuffer 才有用
      });

      flvPlayer.attachMediaElement(video);
      flvPlayer.load();

      // 自动播放策略：多数浏览器需要静音才能自动播放
      const tryPlay = () => video.play().catch(() => {
        // 若失败，可引导用户点“播放”
        console.log('Autoplay blocked; user interaction required.');
      });

      // 建议静音以便自动播放；需要声音时用户手动开声
      video.muted = true;
      tryPlay();

      // 可选：断线重连（简单示例）
      flvPlayer.on(flvjs.Events.ERROR, (type, detail) => {
        console.warn('flv.js error:', type, detail);
        setTimeout(() => {
          flvPlayer.unload();
          flvPlayer.load();
          tryPlay();
        }, 1500);
      });

      // 页面卸载时清理
      window.addEventListener('beforeunload', () => {
        flvPlayer.destroy();
      });
    } else {
      // 不支持 MSE 的环境提示
      document.body.innerHTML = '<p style="color:#fff">当前浏览器不支持 MSE，无法播放 HTTP-FLV。请改用 Chrome/Edge/Firefox，或将流改为 HLS/WebRTC。</p>';
    }
  </script>
</body>
</html>
